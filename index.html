<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HabitForge ‚Äî –ö—É–∑–Ω–∏—Ü–∞ –ü—Ä–∏–≤—ã—á–µ–∫</title>
  <meta name="description" content="–§–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫ —Å —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é">
  <style>
    /* ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
    :root {
      --primary: #2c6fbb;
      --danger: #d32f2f;
      --success: #388e3c;
      --warning: #f57c00;
      --light: #f9f9f9;
      --dark: #333;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      background-color: var(--light);
      color: var(--dark);
      padding: 16px;
      max-width: 600px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin: 20px 0;
    }
    h1 {
      color: var(--primary);
      margin-bottom: 8px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 16px;
      margin: 16px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin: 8px 0;
      transition: all 0.3s ease;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    button.danger {
      background: var(--danger);
    }
    button.success {
      background: var(--success);
    }
    button.warning {
      background: var(--warning);
    }
    .btn-group {
      display: flex;
      gap: 10px;
      margin: 16px 0;
    }
    .btn-group button {
      flex: 1;
      margin: 0;
    }
    .filter-buttons {
      display: flex;
      gap: 8px;
      margin: 16px 0;
    }
    .filter-btn {
      flex: 1;
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      text-align: center;
    }
    .filter-btn.active {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    .filter-btn-all {
      background: #e3f2fd;
      color: var(--primary);
    }
    .filter-btn-all.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    .filter-btn-active {
      background: #fff3e0;
      color: #e65100;
    }
    .filter-btn-active.active {
      background: var(--warning);
      color: white;
      border-color: var(--warning);
    }
    .filter-btn-failed {
      background: #ffebee;
      color: #c62828;
    }
    .filter-btn-failed.active {
      background: var(--danger);
      color: white;
      border-color: var(--danger);
    }
    .filter-btn-completed {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .filter-btn-completed.active {
      background: var(--success);
      color: white;
      border-color: var(--success);
    }
    .current-month-info {
      margin: 12px 0;
      padding: 10px;
      background: #f0f7ff;
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
      color: var(--primary);
      font-weight: bold;
      border-left: 4px solid var(--primary);
    }
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .page-btn {
      background: white;
      color: var(--primary);
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 8px 12px;
      min-width: 40px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
      font-weight: bold;
    }
    .page-btn:hover {
      background: #f0f7ff;
      border-color: var(--primary);
    }
    .page-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    .page-btn.disabled {
      background: #f5f5f5;
      color: #999;
      cursor: not-allowed;
      border-color: #eee;
    }
    .page-info {
      text-align: center;
      margin: 10px 0;
      color: #666;
      font-size: 14px;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }
    label {
      display: block;
      margin: 8px 0 4px;
      font-weight: bold;
    }
    .progress {
      height: 12px;
      background: #eee;
      border-radius: 6px;
      margin: 12px 0;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: var(--primary);
      transition: width 0.3s;
    }
    .hidden {
      display: none !important;
    }
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-success { background-color: var(--success); }
    .status-skipped { background-color: var(--danger); }
    .status-pending { background-color: #ccc; }
    .history-list {
      margin: 16px 0;
    }
    .history-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .history-date {
      font-weight: bold;
    }
    .history-status {
      font-weight: bold;
    }
    .challenge-list {
      margin: 16px 0;
    }
    .challenge-item {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 12px;
      margin: 12px 0;
      border-left: 4px solid var(--primary);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .challenge-item.active {
      border-left-color: var(--warning);
      background: #fff8e1;
    }
    .challenge-item.completed-success {
      border-left-color: var(--success);
      background: #f0f9f0;
    }
    .challenge-item.completed-failure {
      border-left-color: var(--danger);
      background: #ffebee;
    }
    .challenge-content {
      flex: 1;
      cursor: pointer;
    }
    .challenge-title {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .challenge-info {
      font-size: 14px;
      color: #666;
      margin-bottom: 4px;
    }
    .challenge-stats {
      font-size: 13px;
      color: #888;
    }
    .status-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      margin-right: 8px;
    }
    .status-badge.active {
      background: #fff3e0;
      color: #e65100;
    }
    .status-badge.completed {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .status-badge.failed {
      background: #ffebee;
      color: #c62828;
    }
    .delete-btn {
      background: transparent;
      color: #999;
      border: none;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 18px;
      width: auto;
      margin: 0 0 0 12px;
      min-width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    .delete-btn:hover {
      background: #ffebee;
      color: var(--danger);
      transform: scale(1.1);
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 16px;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .modal {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      text-align: center;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .modal h3 {
      margin-bottom: 16px;
      color: var(--dark);
    }
    .modal p {
      margin-bottom: 24px;
      color: #666;
      line-height: 1.5;
    }
    .modal-buttons {
      display: flex;
      gap: 12px;
    }
    .modal-buttons button {
      flex: 1;
      margin: 0;
    }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
      font-size: 16px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 2px dashed #ddd;
      margin: 20px 0;
    }
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.3;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      color: #888;
      font-size: 14px;
    }
    .skip-indicator {
      margin: 12px 0;
      padding: 10px;
      border-radius: 8px;
      background: #fff3e0;
      border-left: 4px solid var(--warning);
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .skip-indicator.limit-reached {
      background: #ffebee;
      border-left-color: var(--danger);
    }
    .skip-count {
      font-weight: bold;
      color: var(--dark);
    }
    .skip-limit {
      color: #666;
      font-size: 13px;
    }
    .time-warning {
      margin: 8px 0;
      padding: 8px 12px;
      border-radius: 8px;
      background: #fff3e0;
      border-left: 4px solid var(--warning);
      font-size: 13px;
      color: #e65100;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .time-warning.danger {
      background: #ffebee;
      border-left-color: var(--danger);
      color: #c62828;
    }
    .help-content {
      max-height: 70vh;
      overflow-y: auto;
      padding-right: 8px;
      margin-bottom: 20px;
    }
    .help-content h3 {
      color: var(--primary);
      margin: 20px 0 10px 0;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 5px;
    }
    .help-content h3:first-child {
      margin-top: 0;
    }
    .help-content ul {
      margin: 10px 0 10px 20px;
    }
    .help-content li {
      margin-bottom: 8px;
    }
    .help-content strong {
      color: var(--primary);
    }
    .help-content .warning {
      color: var(--warning);
      font-weight: bold;
    }
    .help-content .danger {
      color: var(--danger);
      font-weight: bold;
    }
    .help-content .success {
      color: var(--success);
      font-weight: bold;
    }
    .feature-icon {
      display: inline-block;
      width: 24px;
      text-align: center;
      margin-right: 8px;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ */
    .profile-container {
      text-align: center;
      padding: 20px 0;
    }
    .avatar-container {
      position: relative;
      width: 150px;
      height: 150px;
      margin: 0 auto 20px;
    }
    .avatar {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--primary);
      background: #f0f7ff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      color: var(--primary);
    }
    .avatar-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: #f0f7ff;
      border: 4px solid var(--primary);
      font-size: 60px;
      color: var(--primary);
    }
    .avatar-btn {
      position: absolute;
      bottom: 0;
      right: 0;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }
    .avatar-btn:hover {
      background: #1a5ca3;
      transform: scale(1.1);
    }
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin: 20px 0;
    }
    .stat-card {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border-left: 4px solid var(--primary);
    }
    .stat-card.success {
      border-left-color: var(--success);
      background: #f0f9f0;
    }
    .stat-card.failed {
      border-left-color: var(--danger);
      background: #ffebee;
    }
    .stat-number {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .stat-label {
      color: #666;
      font-size: 14px;
      font-weight: 500;
    }
    .total-stat {
      background: #f0f7ff;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      border-left: 4px solid var(--warning);
    }
    .total-stat .stat-number {
      font-size: 40px;
      color: var(--warning);
    }
    .success-rate {
      background: #e8f5e9;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      border-left: 4px solid var(--success);
    }
    .success-rate .stat-number {
      font-size: 36px;
      color: var(--success);
    }
    .profile-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #f0f0f0;
    }
    .profile-title {
      font-size: 24px;
      color: var(--primary);
      font-weight: bold;
    }
    .profile-actions {
      display: flex;
      gap: 10px;
    }
    .profile-actions button {
      width: auto;
      padding: 8px 16px;
      font-size: 14px;
    }
    .back-btn {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin: 8px 0;
      transition: all 0.3s ease;
    }
    .back-btn:hover {
      background: #f0f7ff;
    }
    .avatar-input {
      display: none;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –≤—Ö–æ–¥–∞ */
    .auth-container {
      max-width: 400px;
      margin: 40px auto;
      padding: 20px;
    }
    
    .auth-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .auth-tabs {
      display: flex;
      margin-bottom: 24px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .auth-tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      font-weight: bold;
      color: #666;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
    }
    
    .auth-tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }
    
    .auth-form {
      display: none;
    }
    
    .auth-form.active {
      display: block;
    }
    
    .auth-error {
      background: #ffebee;
      color: #d32f2f;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      border-left: 4px solid #d32f2f;
      font-size: 14px;
      display: none;
    }
    
    .auth-error.show {
      display: block;
    }
    
    .auth-success {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      border-left: 4px solid #2e7d32;
      font-size: 14px;
      display: none;
    }
    
    .auth-success.show {
      display: block;
    }
    
    /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ */
    .profile-user-info {
      text-align: right;
      margin-bottom: 20px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
    }
    
    .profile-user-email {
      font-weight: bold;
      color: var(--primary);
      font-size: 16px;
      margin-bottom: 8px;
    }
    
    .profile-logout-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      width: auto;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .profile-logout-btn:hover {
      background: #b71c1c;
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(183, 28, 28, 0.3);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞ –ø–æ–¥ –∞–≤–∞—Ç–∞—Ä–∫–æ–π */
    .user-login-display {
      margin-top: 16px;
      font-size: 18px;
      font-weight: bold;
      color: var(--primary);
      text-align: center;
      padding: 8px 16px;
      background: #f0f7ff;
      border-radius: 8px;
      display: inline-block;
      position: relative;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞ */
    .edit-login-btn {
      background: transparent;
      color: var(--primary);
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      margin-left: 8px;
      transition: all 0.2s ease;
    }
    
    .edit-login-btn:hover {
      background: #f0f7ff;
      transform: scale(1.1);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞ */
    .change-login-container {
      text-align: left;
      margin-top: 20px;
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid var(--warning);
    }
    
    .change-login-container h3 {
      color: var(--primary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .change-login-note {
      margin-top: 12px;
      padding: 8px 12px;
      background: #fff3e0;
      border-radius: 6px;
      font-size: 13px;
      color: #e65100;
      border-left: 3px solid var(--warning);
    }
    
    .change-login-warning {
      margin-top: 12px;
      padding: 12px;
      background: #ffebee;
      border-radius: 6px;
      font-size: 14px;
      color: #d32f2f;
      border-left: 3px solid var(--danger);
      text-align: center;
    }
    
    .time-remaining {
      font-weight: bold;
      color: var(--dark);
      margin: 8px 0;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <div id="screen-auth" class="auth-container">
    <div class="auth-card">
      <div class="auth-tabs">
        <div class="auth-tab active" data-tab="login">–í—Ö–æ–¥</div>
        <div class="auth-tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
      </div>
      
      <div id="login-form" class="auth-form active">
        <h2 style="text-align: center; margin-bottom: 24px; color: var(--primary);">–í—Ö–æ–¥ –≤ HabitForge</h2>
        
        <div id="login-error" class="auth-error"></div>
        
        <label for="login-email">Email</label>
        <input type="email" id="login-email" placeholder="–í–∞—à email" required>
        
        <label for="login-password">–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="login-password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required>
        
        <button id="btn-login">–í–æ–π—Ç–∏</button>
        
        <p style="text-align: center; margin-top: 16px; color: #666; font-size: 14px;">
          –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="switch-to-register" style="color: var(--primary); font-weight: bold;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
        </p>
      </div>
      
      <div id="register-form" class="auth-form">
        <h2 style="text-align: center; margin-bottom: 24px; color: var(--primary);">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        
        <div id="register-error" class="auth-error"></div>
        <div id="register-success" class="auth-success"></div>
        
        <label for="register-username">–õ–æ–≥–∏–Ω</label>
        <input type="text" id="register-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω" required>
        
        <label for="register-email">Email</label>
        <input type="email" id="register-email" placeholder="–í–∞—à email" required>
        
        <label for="register-password">–ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)</label>
        <input type="password" id="register-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" required>
        
        <label for="register-confirm-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
        <input type="password" id="register-confirm-password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
        
        <button id="btn-register">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        
        <p style="text-align: center; margin-top: 16px; color: #666; font-size: 14px;">
          –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="switch-to-login" style="color: var(--primary); font-weight: bold;">–í–æ–π—Ç–∏</a>
        </p>
      </div>
    </div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞) -->
  <div id="main-container" class="hidden">
    <!-- –£–±—Ä–∞–Ω—ã –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —Å–≤–µ—Ä—Ö—É -->

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="delete-modal" class="modal-overlay hidden">
      <div class="modal">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
        <p id="delete-modal-text">–£–≤–µ—Ä–µ–Ω—ã –ª–∏ –≤—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –∏ —É–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂?</p>
        <div class="modal-buttons">
          <button id="btn-confirm-delete" class="danger">üóë –£–¥–∞–ª–∏—Ç—å</button>
          <button id="btn-cancel-delete">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–ø—Ä–∞–≤–∫–∏ -->
    <div id="help-modal" class="modal-overlay hidden">
      <div class="modal">
        <h3>üìö –°–ø—Ä–∞–≤–∫–∞ –ø–æ HabitForge</h3>
        <div class="help-content">
          <h3>üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ HabitForge?</h3>
          <p>HabitForge ‚Äî —ç—Ç–æ —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫ —Å —Å–∏—Å—Ç–µ–º–æ–π —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. –í—ã —Å—Ç–∞–≤–∏—Ç–µ —Ü–µ–ª–∏, –¥–µ–ª–∞–µ—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç–∞–≤–∫–∏ –∏ —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç–µ —Å–∏–ª—É –≤–æ–ª–∏.</p>
          
          <h3>üöÄ –ö–∞–∫ –Ω–∞—á–∞—Ç—å?</h3>
          <ul>
            <li><span class="feature-icon">‚ûï</span> <strong>–°–æ–∑–¥–∞–π—Ç–µ —á–µ–ª–ª–µ–Ω–¥–∂</strong> ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ, —É–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</li>
            <li><span class="feature-icon">üí∞</span> <strong>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞–≤–∫—É</strong> ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Å—É–º–º–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã "—Ä–∏—Å–∫—É–µ—Ç–µ"</li>
            <li><span class="feature-icon">‚öôÔ∏è</span> <strong>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</strong> ‚Äî –∫—É–¥–∞ —É–π–¥—É—Ç –¥–µ–Ω—å–≥–∏ –ø—Ä–∏ —Å—Ä—ã–≤–µ (–±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–ª–∏ –æ–±—â–∏–π –∫–æ—Ç—ë–ª)</li>
          </ul>
          
          <h3>üìä –≠–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞</h3>
          <ul>
            <li><span class="feature-icon">üìà</span> <strong>–ü—Ä–æ–≥—Ä–µ—Å—Å</strong> ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞ 7 –¥–Ω–µ–π</li>
            <li><span class="feature-icon">‚úÖ</span> <strong>–û—Ç–º–µ—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</strong> ‚Äî –æ—Ç–º–µ—á–∞–π—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ</li>
            <li><span class="feature-icon">‚ùå</span> <strong>–õ–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤</strong> ‚Äî —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤</li>
            <li><span class="feature-icon">‚ö†Ô∏è</span> <span class="warning">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</span> ‚Äî –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ–ø—É—Å–∫ = —Å—Ä—ã–≤</li>
            <li><span class="feature-icon">üìñ</span> <strong>–ò—Å—Ç–æ—Ä–∏—è</strong> ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –æ—Ç–º–µ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</li>
          </ul>
          
          <h3>üìã –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</h3>
          <ul>
            <li><span class="feature-icon">üî•</span> <strong>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è</strong> ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É: –≤—Å–µ, –∞–∫—Ç–∏–≤–Ω—ã–µ, –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ, —Å—Ä—ã–≤—ã</li>
            <li><span class="feature-icon">üìÖ</span> <strong>–§–∏–ª—å—Ç—Ä –ø–æ –º–µ—Å—è—Ü–∞–º</strong> ‚Äî –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏ —Å—Ä—ã–≤–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞</li>
            <li><span class="feature-icon">üìÑ</span> <strong>–ü–∞–≥–∏–Ω–∞—Ü–∏—è</strong> ‚Äî —É–¥–æ–±–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</li>
            <li><span class="feature-icon">üóëÔ∏è</span> <strong>–£–¥–∞–ª–µ–Ω–∏–µ</strong> ‚Äî –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</li>
          </ul>
          
          <h3>‚è∞ –°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ</h3>
          <ul>
            <li><span class="feature-icon">üïê</span> <strong>–ü–µ—Ä–≤—ã–µ 12 —á–∞—Å–æ–≤</strong> ‚Äî –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂ –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π</li>
            <li><span class="feature-icon">‚è∞</span> <strong>–¢–∞–π–º–µ—Ä</strong> ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è</li>
            <li><span class="feature-icon">üíÄ</span> <strong>–ü–æ—Å–ª–µ 12 —á–∞—Å–æ–≤</strong> ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ = —Å—Ä—ã–≤, —Å—Ç–∞–≤–∫–∞ —Ç–µ—Ä—è–µ—Ç—Å—è</li>
            <li><span class="feature-icon">‚ö†Ô∏è</span> <span class="warning">–í–∞–∂–Ω–æ</span> ‚Äî —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç –≤–∞—Å –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º</li>
          </ul>
          
          <h3>üéØ –ü—Ä–∞–≤–∏–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</h3>
          <ul>
            <li><span class="feature-icon">‚úÖ</span> <span class="success">–£—Å–ø–µ—Ö</span> ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –±–æ–ª—å—à–µ –¥–Ω–µ–π, —á–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å + –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤</li>
            <li><span class="feature-icon">üíÄ</span> <span class="danger">–°—Ä—ã–≤</span> ‚Äî –µ—Å–ª–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –±–æ–ª—å—à–µ, —á–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–Ω–µ–π –ò–õ–ò –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤</li>
            <li><span class="feature-icon">üí∞</span> <strong>–°—Ç–∞–≤–∫–∞ –ø—Ä–∏ —Å—Ä—ã–≤–µ</strong> ‚Äî —É—Ö–æ–¥–∏—Ç –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç (–±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å/–∫–æ—Ç—ë–ª)</li>
          </ul>
          
          <h3>‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</h3>
          <ul>
            <li><span class="feature-icon">üíæ</span> <strong>–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ</strong> ‚Äî –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ</li>
            <li><span class="feature-icon">üì±</span> <strong>–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω</strong> ‚Äî —É–¥–æ–±–Ω–æ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–µ</li>
            <li><span class="feature-icon">üîÑ</span> <strong>–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</strong> ‚Äî –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
          </ul>
          
          <h3>üéÆ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h3>
          <ul>
            <li><span class="feature-icon">üî¢</span> <strong>–ú–∞–∫—Å–∏–º—É–º 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</strong> ‚Äî —á—Ç–æ–±—ã –Ω–µ —Ä–∞—Å–ø—ã–ª—è—Ç—å—Å—è</li>
            <li><span class="feature-icon">üìä</span> <strong>–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong> ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å, –ø—Ä–æ–ø—É—Å–∫–∏, —É—Å–ø–µ—à–Ω–æ—Å—Ç—å</li>
            <li><span class="feature-icon">üéØ</span> <strong>–ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞</strong> ‚Äî —Å—Ç–∞–≤–∫–∏ + –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</li>
            <li><span class="feature-icon">üîÑ</span> <strong>–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</strong> ‚Äî –æ—Ç 3 –¥–æ 6 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é</li>
          </ul>
        </div>
        <button id="btn-close-help">–ó–∞–∫—Ä—ã—Ç—å —Å–ø—Ä–∞–≤–∫—É</button>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞ -->
    <div id="change-login-modal" class="modal-overlay hidden">
      <div class="modal">
        <h3>‚úèÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–Ω–∞</h3>
        <div id="change-login-content">
          <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å—Å—è -->
        </div>
        <div class="modal-buttons">
          <button id="btn-save-login" class="success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button id="btn-cancel-login">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </div>

    <header>
      <h1>üî• HabitForge</h1>
      <p>–§–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫ —Å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é</p>
    </header>

    <!-- –≠–∫—Ä–∞–Ω: –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞ -->
    <div id="screen-start" class="card">
      <h2>–ù–∞—á–Ω–∏—Ç–µ —Ñ–∏—Ç–Ω–µ—Å-—á–µ–ª–ª–µ–Ω–¥–∂!</h2>
      <p>–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ, –∑–∞–¥–∞–π—Ç–µ –ø–ª–∞–Ω ‚Äî –∏ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ—Å—å –µ–≥–æ!</p>
      <button id="btn-new">‚ûï –ù–æ–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂</button>
      <button id="btn-view-challenges">üìã –°–ø–∏—Å–æ–∫ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</button>
      <button id="btn-profile" class="warning">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</button>
      <button id="btn-help">üìö –°–ø—Ä–∞–≤–∫–∞ –æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∏ –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç -->
    <div id="screen-profile" class="card hidden">
      <div class="profile-header">
        <div class="profile-title">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</div>
        <div class="profile-actions">
          <button id="btn-back-from-profile" class="back-btn">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
      </div>
      
      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –∫–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
      <div class="profile-user-info">
        <div class="profile-user-email" id="profile-user-email-display"></div>
        <button id="btn-profile-logout" class="profile-logout-btn">–í—ã–π—Ç–∏</button>
      </div>
      
      <div class="profile-container">
        <!-- –ê–≤–∞—Ç–∞—Ä -->
        <div class="avatar-container">
          <div id="avatar-placeholder" class="avatar-placeholder">üë§</div>
          <img id="avatar-image" class="avatar hidden" src="" alt="–ê–≤–∞—Ç–∞—Ä">
          <button id="btn-avatar" class="avatar-btn">üì∑</button>
          <input type="file" id="avatar-input" class="avatar-input" accept="image/*">
        </div>
        
        <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–∏–Ω–∞ –ø–æ–¥ –∞–≤–∞—Ç–∞—Ä–∫–æ–π —Å –∫–Ω–æ–ø–∫–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏—è -->
        <div class="user-login-display" id="user-login-display"></div>
        
        <h3>–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        
        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="total-stat">
          <div class="stat-number" id="total-challenges">0</div>
          <div class="stat-label">–í—Å–µ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</div>
        </div>
        
        <!-- –°–µ—Ç–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div class="stats-grid">
          <div class="stat-card success">
            <div class="stat-number" id="completed-challenges">0</div>
            <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
          </div>
          
          <div class="stat-card failed">
            <div class="stat-number" id="failed-challenges">0</div>
            <div class="stat-label">–°—Ä—ã–≤–æ–≤</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-number" id="active-challenges">0</div>
            <div class="stat-label">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
          </div>
          
          <div class="stat-card">
            <div class="stat-number" id="total-days">0</div>
            <div class="stat-label">–í—Å–µ–≥–æ –¥–Ω–µ–π</div>
          </div>
        </div>
        
        <!-- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ -->
        <div class="success-rate">
          <div class="stat-number" id="success-rate">0%</div>
          <div class="stat-label">–û–±—â–∞—è —É—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
        </div>
        
        <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div style="text-align: left; margin-top: 24px;">
          <h4>üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h4>
          <p>‚úÖ <strong>–í—ã–ø–æ–ª–Ω–µ–Ω–æ:</strong> <span id="total-completed-days">0</span> –¥–Ω–µ–π</p>
          <p>‚ùå <strong>–ü—Ä–æ–ø—É—â–µ–Ω–æ:</strong> <span id="total-skipped-days">0</span> –¥–Ω–µ–π</p>
          <p>üí∞ <strong>–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫:</strong> <span id="total-bets">0</span> ‚ÇΩ</p>
          <p>üéØ <strong>–°—Ä–µ–¥–Ω—è—è —Å—Ç–∞–≤–∫–∞:</strong> <span id="average-bet">0</span> ‚ÇΩ</p>
        </div>
      </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω: –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∞ -->
    <div id="screen-create" class="card hidden">
      <h2>–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∏—Ç–Ω–µ—Å-—Ü–µ–ª—å</h2>
      
      <p id="challenge-limit-warning" style="color: #d32f2f; margin-bottom: 16px; display: none;">
        ‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤ 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π. –ó–∞–≤–µ—Ä—à–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —Ç–µ–∫—É—â–∏—Ö –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
      </p>

      <label for="exercise-select">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</label>
      <select id="exercise-select">
        <option value="–û—Ç–∂–∏–º–∞–Ω–∏—è">–û—Ç–∂–∏–º–∞–Ω–∏—è</option>
        <option value="–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è">–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è</option>
        <option value="–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è">–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è</option>
        <option value="–ü–ª–∞–Ω–∫–∞">–ü–ª–∞–Ω–∫–∞</option>
        <option value="–ë–µ–≥">–ë–µ–≥</option>
        <option value="–•–æ–¥—å–±–∞">–•–æ–¥—å–±–∞</option>
        <option value="–ü—Ä–µ—Å—Å">–ü—Ä–µ—Å—Å (—Å–∫—Ä—É—á–∏–≤–∞–Ω–∏—è)</option>
      </select>

      <label for="reps-input">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –≤ –ø–æ–¥—Ö–æ–¥–µ (–º–∞–∫—Å: 30)</label>
      <input type="number" id="reps-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15" min="1" max="30" value="15">

      <label for="sets-input">–ü–æ–¥—Ö–æ–¥–æ–≤ –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É (–º–∞–∫—Å: 15)</label>
      <input type="number" id="sets-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 3" min="1" max="15" value="3">

      <!-- –ò–ó–ú–ï–ù–ï–ù–û: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–æ —Å 1 –Ω–∞ 3 -->
      <label for="days-input">–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é (–æ—Ç 3 –¥–æ 6)</label>
      <input type="number" id="days-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 3" min="3" max="6" value="3">
      <p style="color: #666; font-size: 14px; margin-top: -4px; margin-bottom: 12px;">
        <span id="skip-limit-info">–î–æ–ø—É—Å—Ç–∏–º–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤: 4</span>
      </p>

      <label for="bet-input">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ (‚ÇΩ) (–º–∞–∫—Å: 1500)</label>
      <input type="number" id="bet-input" placeholder="–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞" min="0" max="1500" value="500">

      <label for="mode-select">–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å—Ä—ã–≤–µ?</label>
      <select id="mode-select">
        <option value="charity">–ù–∞ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
        <option value="pot">–í –æ–±—â–∏–π –∫–æ—Ç—ë–ª (—Ä–æ–∑—ã–≥—Ä—ã—à)</option>
      </select>

      <button id="btn-create-confirm">‚úÖ –ù–∞—á–∞—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂</button>
      <button id="btn-create-cancel">–û—Ç–º–µ–Ω–∞</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω: –ê–∫—Ç–∏–≤–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂ -->
    <div id="screen-active" class="card hidden">
      <h2 id="active-habit-title"></h2>
      <p>–°—Ç–∞–≤–∫–∞: <strong id="active-bet"></strong> ‚ÇΩ</p>
      <p>–†–µ–∂–∏–º: <span id="active-mode"></span></p>
      
      <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–ø—É—Å–∫–æ–≤ -->
      <div id="skip-indicator" class="skip-indicator">
        <div>
          <span class="skip-count">–ü—Ä–æ–ø—É—â–µ–Ω–æ: <span id="skip-current">0</span></span>
          <span class="skip-limit">–∏–∑ <span id="skip-max">4</span> –¥–æ–ø—É—Å—Ç–∏–º–æ</span>
        </div>
        <div id="skip-warning" style="color: #d32f2f; font-weight: bold; display: none;">
          ‚ö†Ô∏è –õ–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤!
        </div>
      </div>
      
      <div>–î–Ω–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: <span id="days-done">0</span> / <span id="days-total">7</span></div>
      <div class="progress">
        <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
      </div>

      <h3>–û—Ç–º–µ—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
      <div class="btn-group">
        <button id="btn-mark-done" class="success">‚úÖ –í—ã–ø–æ–ª–Ω–∏–ª</button>
        <button id="btn-mark-skipped" class="danger">‚ùå –ü—Ä–æ–ø—É—Å—Ç–∏–ª</button>
      </div>
      
      <div id="skip-limit-reached-warning" style="color: #d32f2f; padding: 10px; background: #ffebee; border-radius: 8px; margin: 12px 0; display: none;">
        ‚ö†Ô∏è –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤! –°–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ–ø—É—Å–∫ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ —Å—Ä—ã–≤—É —á–µ–ª–ª–µ–Ω–¥–∂–∞.
      </div>

      <h3>–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
      <div id="history-list" class="history-list">
        <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>

      <button id="btn-view-all-challenges">üìã –ö —Å–ø–∏—Å–∫—É —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</button>
      <button id="btn-give-up" class="danger">üíÄ –°–¥–∞—Ç—å—Å—è (–ø–æ–ª–Ω—ã–π —Å—Ä—ã–≤)</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π -->
    <div id="screen-challenges" class="card hidden">
      <h2>üìã –í—Å–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏</h2>
      <p>–ú–∞–∫—Å–∏–º—É–º 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</p>
      
      <!-- –ö–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
      <div class="filter-buttons">
        <div class="filter-btn filter-btn-all active" data-filter="all">
          üìã –í—Å–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏
        </div>
        <div class="filter-btn filter-btn-active" data-filter="active">
          üî• –í –ø—Ä–æ—Ü–µ—Å—Å–µ
        </div>
        <div class="filter-btn filter-btn-completed" data-filter="completed">
          ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
        </div>
        <div class="filter-btn filter-btn-failed" data-filter="failed">
          üíÄ –°—Ä—ã–≤
        </div>
      </div>
      
      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∏ –°—Ä—ã–≤) -->
      <div id="current-month-info" class="current-month-info hidden">
        <!-- –¢–µ–∫—Å—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
      
      <div id="challenges-list" class="challenge-list">
        <!-- –°–ø–∏—Å–æ–∫ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
      
      <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
      <div id="pagination" class="pagination hidden">
        <!-- –ö–Ω–æ–ø–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
      
      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ -->
      <div id="page-info" class="page-info hidden"></div>
      
      <button id="btn-add-new-challenge">‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂</button>
      <button id="btn-back-from-challenges">–ù–∞–∑–∞–¥</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω: –ò—Ç–æ–≥ -->
    <div id="screen-result" class="card hidden">
      <h2 id="result-title"></h2>
      <p id="result-text"></p>
      
      <h3>–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
      <div id="result-stats"></div>
      
      <button id="btn-new-again">–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂</button>
      <button id="btn-to-challenges">üìã –ö —Å–ø–∏—Å–∫—É —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</button>
    </div>

    <footer>
      –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
    </footer>
  </div>

  <script>
    // ==================== –°–ò–°–¢–ï–ú–ê –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò ====================
    
    // –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è (—É–ø—Ä–æ—â—ë–Ω–Ω–æ–µ, –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
    function hashPassword(password) {
      let hash = 0;
      for (let i = 0; i < password.length; i++) {
        const char = password.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      return hash.toString(36);
    }
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ localStorage
    function getAllUsers() {
      const users = localStorage.getItem('habitforge-users');
      return users ? JSON.parse(users) : {};
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ localStorage
    function saveAllUsers(users) {
      localStorage.setItem('habitforge-users', JSON.stringify(users));
    }
    
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function registerUser(username, email, password) {
      const users = getAllUsers();
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email
      if (users[email]) {
        return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º
      const existingUserWithUsername = Object.values(users).find(user => user.username === username);
      if (existingUserWithUsername) {
        return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ø–∞—Ä–æ–ª—è
      if (password.length < 6) {
        return { success: false, message: '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤' };
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ª–æ–≥–∏–Ω–∞
      if (username.length < 3) {
        return { success: false, message: '–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞' };
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ª–æ–≥–∏–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã
      if (!/^[a-zA-Z0-9_]+$/.test(username)) {
        return { success: false, message: '–õ–æ–≥–∏–Ω –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å–∏–º–≤–æ–ª –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è' };
      }
      
      // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      users[email] = {
        username: username,
        email: email,
        passwordHash: hashPassword(password),
        createdAt: new Date().toISOString(),
        lastLoginChange: null, // –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞
        avatar: null,
        challenges: []
      };
      
      saveAllUsers(users);
      return { success: true, message: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!' };
    }
    
    // –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ email)
    function loginUser(email, password) {
      const users = getAllUsers();
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      if (!users[email]) {
        return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
      if (users[email].passwordHash !== hashPassword(password)) {
        return { success: false, message: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' };
      }
      
      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      localStorage.setItem('habitforge-current-user', email);
      return { success: true, message: '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ' };
    }
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function getCurrentUser() {
      return localStorage.getItem('habitforge-current-user');
    }
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function getCurrentUserData() {
      const email = getCurrentUser();
      if (!email) return null;
      
      const users = getAllUsers();
      return users[email] || null;
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function saveCurrentUserData(userData) {
      const email = getCurrentUser();
      if (!email) return;
      
      const users = getAllUsers();
      users[email] = userData;
      saveAllUsers(users);
    }
    
    // –í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function logoutUser() {
      localStorage.removeItem('habitforge-current-user');
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–Ω (—Ä–∞–∑ –≤ 2 –Ω–µ–¥–µ–ª–∏)
    function canChangeLogin() {
      const userData = getCurrentUserData();
      if (!userData || !userData.lastLoginChange) return true;
      
      const now = new Date();
      const lastChange = new Date(userData.lastLoginChange);
      const twoWeeksInMs = 14 * 24 * 60 * 60 * 1000; // 2 –Ω–µ–¥–µ–ª–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
      
      return (now - lastChange) >= twoWeeksInMs;
    }
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞
    function getTimeUntilLoginChange() {
      const userData = getCurrentUserData();
      if (!userData || !userData.lastLoginChange) return null;
      
      const now = new Date();
      const lastChange = new Date(userData.lastLoginChange);
      const twoWeeksInMs = 14 * 24 * 60 * 60 * 1000;
      const timePassed = now - lastChange;
      const timeRemaining = twoWeeksInMs - timePassed;
      
      if (timeRemaining <= 0) return null;
      
      const days = Math.floor(timeRemaining / (24 * 60 * 60 * 1000));
      const hours = Math.floor((timeRemaining % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
      const minutes = Math.floor((timeRemaining % (60 * 60 * 1000)) / (60 * 1000));
      
      return { days, hours, minutes };
    }
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function formatTimeRemaining(time) {
      if (!time) return null;
      
      const parts = [];
      if (time.days > 0) {
        const daysText = time.days === 1 ? '–¥–µ–Ω—å' : 
                        (time.days >= 2 && time.days <= 4 ? '–¥–Ω—è' : '–¥–Ω–µ–π');
        parts.push(`${time.days} ${daysText}`);
      }
      if (time.hours > 0) {
        const hoursText = time.hours === 1 ? '—á–∞—Å' : 
                         (time.hours >= 2 && time.hours <= 4 ? '—á–∞—Å–∞' : '—á–∞—Å–æ–≤');
        parts.push(`${time.hours} ${hoursText}`);
      }
      if (time.minutes > 0) {
        const minutesText = time.minutes === 1 ? '–º–∏–Ω—É—Ç–∞' : 
                           (time.minutes >= 2 && time.minutes <= 4 ? '–º–∏–Ω—É—Ç—ã' : '–º–∏–Ω—É—Ç');
        parts.push(`${time.minutes} ${minutesText}`);
      }
      
      return parts.join(' ');
    }
    
    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function changeUsername(newUsername) {
      const userData = getCurrentUserData();
      if (!userData) return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –ª–æ–≥–∏–Ω–∞
      if (newUsername.length < 3) {
        return { success: false, message: '–õ–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞' };
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ª–æ–≥–∏–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã
      if (!/^[a-zA-Z0-9_]+$/.test(newUsername)) {
        return { success: false, message: '–õ–æ–≥–∏–Ω –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å–∏–º–≤–æ–ª –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è' };
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º
      const users = getAllUsers();
      const existingUserWithUsername = Object.values(users).find(user => 
        user.username === newUsername && user.email !== userData.email
      );
      
      if (existingUserWithUsername) {
        return { success: false, message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–Ω
      if (!canChangeLogin()) {
        const timeRemaining = getTimeUntilLoginChange();
        const formattedTime = formatTimeRemaining(timeRemaining);
        return { 
          success: false, 
          message: `–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–Ω–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ${formattedTime}` 
        };
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥–∏–Ω
      userData.username = newUsername;
      userData.lastLoginChange = new Date().toISOString();
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
      saveCurrentUserData(userData);
      
      return { success: true, message: '–õ–æ–≥–∏–Ω —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω' };
    }
    
    // ==================== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ====================
    
    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
    const MAX_CHALLENGES = 5;
    const CHALLENGES_PER_PAGE = 5;
    const MAX_PAGES = 10;
    const DELETE_TIME_LIMIT = 12 * 60 * 60 * 1000; // 12 —á–∞—Å–æ–≤ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    let allChallenges = [];
    let userAvatar = null;
    let currentHabitIndex = -1;
    let challengeToDeleteIndex = -1;
    let currentFilter = 'all';
    let currentPage = 1;
    let totalPages = 1;
    
    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const screens = {
      auth: document.getElementById('screen-auth'),
      main: document.getElementById('main-container'),
      start: document.getElementById('screen-start'),
      profile: document.getElementById('screen-profile'),
      create: document.getElementById('screen-create'),
      active: document.getElementById('screen-active'),
      challenges: document.getElementById('screen-challenges'),
      result: document.getElementById('screen-result'),
    };
    
    // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
    const deleteModal = document.getElementById('delete-modal');
    const deleteModalText = document.getElementById('delete-modal-text');
    const helpModal = document.getElementById('help-modal');
    const changeLoginModal = document.getElementById('change-login-modal');
    const changeLoginContent = document.getElementById('change-login-content');
    
    // ==================== –§–£–ù–ö–¶–ò–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ====================
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é
    function calculateMaxSkips(daysPerWeek) {
      const skipLimits = {
        6: 1,  // 6 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é ‚Üí 1 –ø—Ä–æ–ø—É—Å–∫
        5: 2,  // 5 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é ‚Üí 2 –ø—Ä–æ–ø—É—Å–∫–∞
        4: 3,  // 4 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é ‚Üí 3 –ø—Ä–æ–ø—É—Å–∫–∞
        3: 4,  // 3 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é ‚Üí 4 –ø—Ä–æ–ø—É—Å–∫–∞
        2: 5,  // 2 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –Ω–µ–¥–µ–ª—é ‚Üí 5 –ø—Ä–æ–ø—É—Å–∫–æ–≤
        1: 6   // 1 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤ –Ω–µ–¥–µ–ª—é ‚Üí 6 –ø—Ä–æ–ø—É—Å–∫–æ–≤
      };
      return skipLimits[daysPerWeek] || 4;
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∏ –≥–æ–¥
    function getCurrentMonthYear() {
      const now = new Date();
      return {
        month: now.getMonth(),
        year: now.getFullYear()
      };
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—è—Ü–∞
    function getMonthName(monthIndex) {
      const months = [
        '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
        '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
      ];
      return months[monthIndex];
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–æ—à–ª–æ –ª–∏ –±–æ–ª–µ–µ 12 —á–∞—Å–æ–≤ —Å –º–æ–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
    function isOver12Hours(challenge) {
      const now = new Date();
      const createdAt = new Date(challenge.createdAt);
      const timeDiff = now - createdAt;
      return timeDiff > DELETE_TIME_LIMIT;
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è 12 —á–∞—Å–æ–≤
    function getRemainingTime(challenge) {
      const now = new Date();
      const createdAt = new Date(challenge.createdAt);
      const timeDiff = now - createdAt;
      const remainingTime = DELETE_TIME_LIMIT - timeDiff;
      
      if (remainingTime <= 0) return 0;
      
      const hours = Math.floor(remainingTime / (60 * 60 * 1000));
      const minutes = Math.floor((remainingTime % (60 * 60 * 1000)) / (60 * 1000));
      
      return { hours, minutes };
    }
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function formatTime(remainingTime) {
      if (remainingTime === 0) return '–∏—Å—Ç–µ–∫–ª–æ';
      
      const hoursText = remainingTime.hours === 1 ? '—á–∞—Å' : 
                       (remainingTime.hours >= 2 && remainingTime.hours <= 4 ? '—á–∞—Å–∞' : '—á–∞—Å–æ–≤');
      const minutesText = remainingTime.minutes === 1 ? '–º–∏–Ω—É—Ç–∞' : 
                         (remainingTime.minutes >= 2 && remainingTime.minutes <= 4 ? '–º–∏–Ω—É—Ç—ã' : '–º–∏–Ω—É—Ç');
      
      return `${remainingTime.hours} ${hoursText} ${remainingTime.minutes} ${minutesText}`;
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏–º–∏—Ç–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —á–µ–ª–ª–µ–Ω–¥–∂–∞
    function updateSkipLimitInfo() {
      const daysInput = document.getElementById('days-input');
      const skipLimitInfo = document.getElementById('skip-limit-info');
      const daysPerWeek = parseInt(daysInput.value) || 3;
      const maxSkips = calculateMaxSkips(daysPerWeek);
      skipLimitInfo.textContent = `–î–æ–ø—É—Å—Ç–∏–º–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤: ${maxSkips}`;
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function initFilters() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      filterButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
          filterButtons.forEach(b => b.classList.remove('active'));
          // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
          btn.classList.add('active');
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∏–ª—å—Ç—Ä
          currentFilter = btn.dataset.filter;
          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
          currentPage = 1;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –º–µ—Å—è—Ü–µ
          const monthInfo = document.getElementById('current-month-info');
          if (currentFilter === 'completed' || currentFilter === 'failed') {
            const current = getCurrentMonthYear();
            const monthName = getMonthName(current.month);
            monthInfo.innerHTML = `üìÖ –ü–æ–∫–∞–∑–∞–Ω—ã —á–µ–ª–ª–µ–Ω–¥–∂–∏ –∑–∞ ${monthName} ${current.year} –≥–æ–¥–∞`;
            monthInfo.classList.remove('hidden');
          } else {
            monthInfo.classList.add('hidden');
          }
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
          renderChallengesList();
        });
      });
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —á–µ–ª–ª–µ–Ω–¥–∂–∞ (–ø–æ—Å–ª–µ–¥–Ω—è—è –æ—Ç–º–µ—Ç–∫–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏)
    function getCompletionDate(challenge) {
      if (challenge.history && challenge.history.length > 0) {
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ –¥–∞—Ç–µ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–Ω–∞—á–∞–ª–∞)
        const sortedHistory = [...challenge.history].sort((a, b) => 
          new Date(b.timestamp) - new Date(a.timestamp)
        );
        return new Date(sortedHistory[0].timestamp);
      }
      // –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è
      return new Date(challenge.createdAt);
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ª–∏ —á–µ–ª–ª–µ–Ω–¥–∂ –∫ —Ç–µ–∫—É—â–µ–º—É –º–µ—Å—è—Ü—É
    function isChallengeInCurrentMonth(challenge) {
      const completionDate = getCompletionDate(challenge);
      const current = getCurrentMonthYear();
      return completionDate.getMonth() === current.month && 
             completionDate.getFullYear() === current.year;
    }
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ–ª–ª–µ–Ω–¥–∂–µ–π –ø–æ —Å—Ç–∞—Ç—É—Å—É
    function filterChallenges(challenges) {
      let filtered = challenges;
      
      // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
      switch(currentFilter) {
        case 'all':
          // –í—Å–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏
          break;
        case 'active':
          // –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ (–≤—Å–µ–≥–¥–∞ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ)
          filtered = filtered.filter(challenge => challenge.isActive);
          break;
        case 'completed':
          // –¢–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
          filtered = filtered.filter(challenge => {
            if (!challenge.isActive) {
              const totalDays = challenge.totalCompleted + challenge.totalSkipped;
              const successRate = totalDays > 0 ? 
                Math.round((challenge.totalCompleted / totalDays) * 100) : 0;
              if (successRate === 100 && challenge.daysSkipped <= challenge.maxSkips && !challenge.deletedAsFailure) {
                return isChallengeInCurrentMonth(challenge);
              }
            }
            return false;
          });
          break;
        case 'failed':
          // –¢–æ–ª—å–∫–æ —Å—Ä—ã–≤—ã –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
          filtered = filtered.filter(challenge => {
            if (!challenge.isActive) {
              const totalDays = challenge.totalCompleted + challenge.totalSkipped;
              const successRate = totalDays > 0 ? 
                Math.round((challenge.totalCompleted / totalDays) * 100) : 0;
              if (successRate < 100 || challenge.daysSkipped > challenge.maxSkips || challenge.deletedAsFailure) {
                return isChallengeInCurrentMonth(challenge);
              }
            }
            return false;
          });
          break;
      }
      
      return filtered;
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function getChallengesForCurrentPage(challenges) {
      // –í—ã—á–∏—Å–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      const startIndex = (currentPage - 1) * CHALLENGES_PER_PAGE;
      const endIndex = startIndex + CHALLENGES_PER_PAGE;
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ä–µ–∑ –º–∞—Å—Å–∏–≤–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      return challenges.slice(startIndex, endIndex);
    }
    
    // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
    function calculateTotalPages(challenges) {
      return Math.max(1, Math.ceil(challenges.length / CHALLENGES_PER_PAGE));
    }
    
    // –°–æ–∑–¥–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é
    function createPagination() {
      const paginationContainer = document.getElementById('pagination');
      const pageInfoContainer = document.getElementById('page-info');
      
      // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
      paginationContainer.innerHTML = '';
      pageInfoContainer.innerHTML = '';
      
      // –ï—Å–ª–∏ –≤—Å–µ–≥–æ 1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–ª–∏ –Ω–µ—Ç —á–µ–ª–ª–µ–Ω–¥–∂–µ–π, —Å–∫—Ä—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
      if (totalPages <= 1) {
        paginationContainer.classList.add('hidden');
        pageInfoContainer.classList.add('hidden');
        return;
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
      paginationContainer.classList.remove('hidden');
      pageInfoContainer.classList.remove('hidden');
      
      // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
      const prevButton = document.createElement('button');
      prevButton.className = `page-btn ${currentPage === 1 ? 'disabled' : ''}`;
      prevButton.innerHTML = '‚Äπ';
      prevButton.onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          renderChallengesList();
        }
      };
      paginationContainer.appendChild(prevButton);
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      let startPage = Math.max(1, currentPage - 2);
      let endPage = Math.min(totalPages, startPage + 4);
      
      // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º startPage, –µ—Å–ª–∏ endPage –±–ª–∏–∑–∫–æ –∫ –∫–æ–Ω—Ü—É
      if (endPage - startPage < 4 && startPage > 1) {
        startPage = Math.max(1, endPage - 4);
      }
      
      // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü
      for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button');
        pageButton.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        pageButton.textContent = i;
        pageButton.onclick = () => {
          if (i !== currentPage) {
            currentPage = i;
            renderChallengesList();
          }
        };
        paginationContainer.appendChild(pageButton);
      }
      
      // –ö–Ω–æ–ø–∫–∞ "–í–ø–µ—Ä–µ–¥"
      const nextButton = document.createElement('button');
      nextButton.className = `page-btn ${currentPage === totalPages ? 'disabled' : ''}`;
      nextButton.innerHTML = '‚Ä∫';
      nextButton.onclick = () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderChallengesList();
        }
      };
      paginationContainer.appendChild(nextButton);
      
      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
      pageInfoContainer.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage} –∏–∑ ${totalPages}`;
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
    function updateAvatarDisplay() {
      const avatarImage = document.getElementById('avatar-image');
      const avatarPlaceholder = document.getElementById('avatar-placeholder');
      
      if (userAvatar) {
        avatarImage.src = userAvatar;
        avatarImage.classList.remove('hidden');
        avatarPlaceholder.classList.add('hidden');
      } else {
        avatarImage.classList.add('hidden');
        avatarPlaceholder.classList.remove('hidden');
      }
    }
    
    // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
    function calculateProfileStats() {
      const stats = {
        total: allChallenges.length,
        completed: 0,
        failed: 0,
        active: 0,
        totalDays: 0,
        totalCompletedDays: 0,
        totalSkippedDays: 0,
        totalBets: 0
      };
      
      allChallenges.forEach(challenge => {
        if (challenge.isActive) {
          stats.active++;
        } else {
          const totalDays = challenge.totalCompleted + challenge.totalSkipped;
          const successRate = totalDays > 0 ? 
            Math.round((challenge.totalCompleted / totalDays) * 100) : 0;
          
          if (successRate === 100 && challenge.daysSkipped <= challenge.maxSkips && !challenge.deletedAsFailure) {
            stats.completed++;
          } else {
            stats.failed++;
          }
        }
        
        stats.totalDays += challenge.totalDays || 0;
        stats.totalCompletedDays += challenge.totalCompleted || 0;
        stats.totalSkippedDays += challenge.totalSkipped || 0;
        stats.totalBets += challenge.bet || 0;
      });
      
      return stats;
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
    function updateProfileUserEmailDisplay() {
      const userData = getCurrentUserData();
      const emailDisplay = document.getElementById('profile-user-email-display');
      if (userData && emailDisplay) {
        emailDisplay.textContent = userData.email;
      }
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ —Å –∫–Ω–æ–ø–∫–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏—è
    function updateUserLoginDisplay() {
      const userData = getCurrentUserData();
      const loginDisplay = document.getElementById('user-login-display');
      if (userData && loginDisplay) {
        loginDisplay.innerHTML = `
          @${userData.username}
          <button class="edit-login-btn" id="btn-edit-login">‚úèÔ∏è</button>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞
        const editBtn = document.getElementById('btn-edit-login');
        if (editBtn) {
          editBtn.onclick = showChangeLoginModal;
        }
      }
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞
    function showChangeLoginModal() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–Ω
      if (canChangeLogin()) {
        // –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
        changeLoginContent.innerHTML = `
          <p>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ª–æ–≥–∏–Ω:</p>
          <input type="text" id="new-username-input" placeholder="–ù–æ–≤—ã–π –ª–æ–≥–∏–Ω" style="margin: 12px 0;">
          <div class="change-login-note">
            ‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –õ–æ–≥–∏–Ω –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑ –≤ 2 –Ω–µ–¥–µ–ª–∏
          </div>
        `;
      } else {
        // –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        const timeRemaining = getTimeUntilLoginChange();
        const formattedTime = formatTimeRemaining(timeRemaining);
        
        changeLoginContent.innerHTML = `
          <div class="change-login-warning">
            ‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–Ω–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑:
            <div class="time-remaining">${formattedTime}</div>
            <p style="margin-top: 8px; font-size: 13px;">
              –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–Ω —Ç–æ–ª—å–∫–æ —Ä–∞–∑ –≤ 2 –Ω–µ–¥–µ–ª–∏
            </p>
          </div>
        `;
        
        // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π
        document.getElementById('btn-save-login').disabled = true;
      }
      
      changeLoginModal.classList.remove('hidden');
    }
    
    // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞
    function hideChangeLoginModal() {
      changeLoginModal.classList.add('hidden');
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
      document.getElementById('btn-save-login').disabled = false;
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞
    function handleLoginChange() {
      if (!canChangeLogin()) {
        hideChangeLoginModal();
        return;
      }
      
      const newUsernameInput = document.getElementById('new-username-input');
      if (!newUsernameInput) {
        hideChangeLoginModal();
        return;
      }
      
      const newUsername = newUsernameInput.value.trim();
      
      if (!newUsername) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ª–æ–≥–∏–Ω');
        return;
      }
      
      const result = changeUsername(newUsername);
      
      if (result.success) {
        alert(result.message);
        hideChangeLoginModal();
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–∏–Ω–∞
        updateUserLoginDisplay();
      } else {
        alert(result.message);
      }
    }
    
    // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
    function renderProfile() {
      const stats = calculateProfileStats();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      updateProfileUserEmailDisplay();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      updateUserLoginDisplay();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä
      updateAvatarDisplay();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      document.getElementById('total-challenges').textContent = stats.total;
      document.getElementById('completed-challenges').textContent = stats.completed;
      document.getElementById('failed-challenges').textContent = stats.failed;
      document.getElementById('active-challenges').textContent = stats.active;
      document.getElementById('total-days').textContent = stats.totalDays;
      document.getElementById('total-completed-days').textContent = stats.totalCompletedDays;
      document.getElementById('total-skipped-days').textContent = stats.totalSkippedDays;
      document.getElementById('total-bets').textContent = stats.totalBets;
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω—é—é —Å—Ç–∞–≤–∫—É
      const averageBet = stats.total > 0 ? Math.round(stats.totalBets / stats.total) : 0;
      document.getElementById('average-bet').textContent = averageBet;
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
      const successRate = stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0;
      document.getElementById('success-rate').textContent = `${successRate}%`;
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
    function renderHistory() {
      if (currentHabitIndex === -1 || !allChallenges[currentHabitIndex]) return;
      
      const currentHabit = allChallenges[currentHabitIndex];
      const historyList = document.getElementById('history-list');
      if (!currentHabit.history || currentHabit.history.length === 0) {
        historyList.innerHTML = '<p>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫–∞ –ø—É—Å—Ç–∞</p>';
        return;
      }
      
      let html = '';
      currentHabit.history.forEach(entry => {
        let statusText = '';
        let statusClass = '';
        
        if (entry.status === 'completed') {
          statusText = '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ';
          statusClass = 'status-success';
        } else if (entry.status === 'skipped') {
          statusText = '‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–æ';
          statusClass = 'status-skipped';
        } else if (entry.status === 'gave-up') {
          statusText = 'üíÄ –°–¥–∞–ª—Å—è';
          statusClass = 'status-skipped';
        } else if (entry.status === 'deleted-failure') {
          statusText = 'üóëÔ∏è –£–¥–∞–ª—ë–Ω (—Å—Ä—ã–≤)';
          statusClass = 'status-skipped';
        }
        
        const date = new Date(entry.date);
        const formattedDate = date.toLocaleDateString('ru-RU', {
          day: '2-digit',
          month: '2-digit',
          weekday: 'short'
        });
        
        html += `
          <div class="history-item">
            <div class="history-date">${formattedDate}</div>
            <div class="history-status ${statusClass.replace('status-', '')}">${statusText}</div>
          </div>
        `;
      });
      
      historyList.innerHTML = html;
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –ø—Ä–æ–ø—É—Å–∫–æ–≤
    function renderActiveHabit() {
      if (currentHabitIndex === -1 || !allChallenges[currentHabitIndex]) return;
      
      const currentHabit = allChallenges[currentHabitIndex];
      
      document.getElementById('active-habit-title').textContent = currentHabit.title;
      document.getElementById('active-bet').textContent = currentHabit.bet;
      document.getElementById('active-mode').textContent =
        currentHabit.mode === 'charity' ? '–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å' : '–û–±—â–∏–π –∫–æ—Ç—ë–ª';
      
      const totalMarked = currentHabit.daysDone + currentHabit.daysSkipped;
      const total = currentHabit.totalDays;
      
      document.getElementById('days-done').textContent = currentHabit.daysDone;
      document.getElementById('days-total').textContent = total;
      document.getElementById('progress-bar').style.width = (totalMarked / total * 100) + '%';
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–ø—É—Å–∫–æ–≤
      const skipIndicator = document.getElementById('skip-indicator');
      const skipCurrent = document.getElementById('skip-current');
      const skipMax = document.getElementById('skip-max');
      const skipWarning = document.getElementById('skip-warning');
      const skipLimitWarning = document.getElementById('skip-limit-reached-warning');
      
      skipCurrent.textContent = currentHabit.daysSkipped;
      skipMax.textContent = currentHabit.maxSkips;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏ –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤
      if (currentHabit.daysSkipped >= currentHabit.maxSkips) {
        skipIndicator.classList.add('limit-reached');
        skipWarning.style.display = 'block';
        skipLimitWarning.style.display = 'block';
      } else {
        skipIndicator.classList.remove('limit-reached');
        skipWarning.style.display = 'none';
        skipLimitWarning.style.display = 'none';
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
      renderHistory();
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º –æ –≤—Ä–µ–º–µ–Ω–∏
    window.showDeleteModal = function(index) {
      challengeToDeleteIndex = index;
      const challenge = allChallenges[index];
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–æ –ª–∏ 12 —á–∞—Å–æ–≤
      if (isOver12Hours(challenge)) {
        // –ü—Ä–æ—à–ª–æ –±–æ–ª–µ–µ 12 —á–∞—Å–æ–≤ - —É–¥–∞–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Å—Ä—ã–≤–æ–º
        deleteModalText.innerHTML = `
          <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong><br>
          –° –º–æ–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–µ–ª–ª–µ–Ω–¥–∂–∞ –ø—Ä–æ—à–ª–æ –±–æ–ª–µ–µ 12 —á–∞—Å–æ–≤.<br>
          –£–¥–∞–ª–µ–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∞ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Å—Ä—ã–≤–æ–º.<br>
          –°—Ç–∞–≤–∫–∞ –≤ —Ä–∞–∑–º–µ—Ä–µ <strong>${challenge.bet} ‚ÇΩ</strong> –±—É–¥–µ—Ç ${challenge.mode === 'charity' ? '–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å' : '–ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –≤ –æ–±—â–∏–π –∫–æ—Ç—ë–ª'}.
        `;
      } else {
        // –ú–µ–Ω–µ–µ 12 —á–∞—Å–æ–≤ - –æ–±—ã—á–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
        const remainingTime = getRemainingTime(challenge);
        deleteModalText.innerHTML = `
          –£–≤–µ—Ä–µ–Ω—ã –ª–∏ –≤—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –∏ —É–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂?<br>
          <div class="time-warning">
            ‚è∞ –£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å: <strong>${formatTime(remainingTime)}</strong> –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ —É–¥–∞–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Å—Ä—ã–≤–æ–º.
          </div>
        `;
      }
      
      deleteModal.classList.remove('hidden');
    };
    
    // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è
    function hideDeleteModal() {
      deleteModal.classList.add('hidden');
      challengeToDeleteIndex = -1;
    }
    
    // –£–¥–∞–ª–∏—Ç—å —á–µ–ª–ª–µ–Ω–¥–∂ —Å —É—á–µ—Ç–æ–º –≤—Ä–µ–º–µ–Ω–∏
    function deleteChallenge(index) {
      if (index >= 0 && index < allChallenges.length) {
        const challenge = allChallenges[index];
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–æ –ª–∏ 12 —á–∞—Å–æ–≤
        if (isOver12Hours(challenge)) {
          // –ü—Ä–æ—à–ª–æ –±–æ–ª–µ–µ 12 —á–∞—Å–æ–≤ - –æ—Ç–º–µ—á–∞–µ–º –∫–∞–∫ —Å—Ä—ã–≤
          challenge.isActive = false;
          challenge.deletedAsFailure = true;
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é –æ —Å—Ä—ã–≤–µ –∏–∑-–∑–∞ —É–¥–∞–ª–µ–Ω–∏—è
          challenge.history.unshift({
            date: new Date().toISOString().split('T')[0],
            status: 'deleted-failure',
            timestamp: new Date().toISOString()
          });
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
          saveUserChallenges();
          
          // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä—ã–≤–∞
          if (currentHabitIndex === index) {
            showResult(false);
          }
        } else {
          // –ú–µ–Ω–µ–µ 12 —á–∞—Å–æ–≤ - –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º
          // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å
          if (currentHabitIndex === index) {
            currentHabitIndex = -1;
          } else if (currentHabitIndex > index) {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å, –µ—Å–ª–∏ –æ–Ω –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–∑-–∑–∞ —É–¥–∞–ª–µ–Ω–∏—è
            currentHabitIndex--;
          }
          
          // –£–¥–∞–ª—è–µ–º —á–µ–ª–ª–µ–Ω–¥–∂ –∏–∑ –º–∞—Å—Å–∏–≤–∞
          allChallenges.splice(index, 1);
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
          saveUserChallenges();
          
          // –ï—Å–ª–∏ –º—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞, –∏ —É–¥–∞–ª–∏–ª–∏ –µ–≥–æ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ø–∏—Å–æ–∫ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
          if (currentHabitIndex === -1 && !screens.active.classList.contains('hidden')) {
            renderChallengesList();
            showScreen('challenges');
          }
        }
      }
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
    function renderChallengesList() {
      const challengesList = document.getElementById('challenges-list');
      
      // –§–∏–ª—å—Ç—Ä—É–µ–º —á–µ–ª–ª–µ–Ω–¥–∂–∏
      const filteredChallenges = filterChallenges(allChallenges);
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
      totalPages = calculateTotalPages(filteredChallenges);
      
      // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –µ—Å–ª–∏ –æ–Ω–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
      if (currentPage > totalPages) {
        currentPage = totalPages;
      }
      
      // –ü–æ–ª—É—á–∞–µ–º —á–µ–ª–ª–µ–Ω–¥–∂–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      const paginatedChallenges = getChallengesForCurrentPage(filteredChallenges);
      
      if (paginatedChallenges.length === 0) {
        let emptyMessage = '–ü—É—Å—Ç–æ';
        let emptyIcon = '';
        
        switch(currentFilter) {
          case 'all':
            emptyIcon = 'üìã';
            break;
          case 'active':
            emptyIcon = 'üî•';
            break;
          case 'completed':
            emptyIcon = '‚úÖ';
            break;
          case 'failed':
            emptyIcon = 'üíÄ';
            break;
        }
        
        challengesList.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">${emptyIcon}</div>
            <p>${emptyMessage}</p>
          </div>
        `;
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é, –µ—Å–ª–∏ –Ω–µ—Ç —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
        document.getElementById('pagination').classList.add('hidden');
        document.getElementById('page-info').classList.add('hidden');
        return;
      }
      
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º: –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞, –∑–∞—Ç–µ–º –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ, –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
      const sortedChallenges = [...paginatedChallenges].sort((a, b) => {
        // –°–Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–Ω—ã–µ, –∑–∞—Ç–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ
        if (a.isActive && !b.isActive) return -1;
        if (!a.isActive && b.isActive) return 1;
        // –ó–∞—Ç–µ–º –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
        return new Date(b.createdAt) - new Date(a.createdAt);
      });
      
      let html = '';
      const activeCount = allChallenges.filter(c => c.isActive).length;
      const totalFiltered = filteredChallenges.length;
      
      html += `<p style="margin-bottom: 16px;"><strong>–ü–æ–∫–∞–∑–∞–Ω–æ: ${paginatedChallenges.length} –∏–∑ ${totalFiltered}</strong></p>`;
      html += `<p style="margin-bottom: 16px; color: #666; font-size: 14px;">–ê–∫—Ç–∏–≤–Ω—ã—Ö: ${activeCount} –∏–∑ ${MAX_CHALLENGES}</p>`;
      
      sortedChallenges.forEach((challenge, index) => {
        const totalMarked = challenge.daysDone + challenge.daysSkipped;
        const progressPercent = Math.round((totalMarked / challenge.totalDays) * 100);
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞—Ç—É—Å
        let status = '';
        let statusText = '';
        let statusClass = '';
        let borderClass = '';
        let timeWarning = '';
        
        if (challenge.isActive) {
          // –ê–∫—Ç–∏–≤–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂
          status = 'active';
          statusText = '–í –ø—Ä–æ—Ü–µ—Å—Å–µ';
          statusClass = 'active';
          borderClass = 'active'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π –±–æ—Ä–¥–µ—Ä
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
          if (isOver12Hours(challenge)) {
            timeWarning = `<div class="time-warning danger">‚ö†Ô∏è –£–¥–∞–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Å—Ä—ã–≤–æ–º!</div>`;
          } else {
            const remainingTime = getRemainingTime(challenge);
            timeWarning = `<div class="time-warning">‚è∞ –î–æ —Å—Ä—ã–≤–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ${formatTime(remainingTime)}</div>`;
          }
        } else {
          // –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂
          const totalDays = challenge.totalCompleted + challenge.totalSkipped;
          const successRate = totalDays > 0 ? 
            Math.round((challenge.totalCompleted / totalDays) * 100) : 0;
          
          if (successRate === 100 && challenge.daysSkipped <= challenge.maxSkips && !challenge.deletedAsFailure) {
            // 100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ò –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ò –Ω–µ —É–¥–∞–ª—ë–Ω –∫–∞–∫ —Å—Ä—ã–≤ = –í—ã–ø–æ–ª–Ω–µ–Ω–æ
            status = 'completed';
            statusText = '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
            statusClass = 'completed';
            borderClass = 'completed-success'; // –ó–µ–ª—ë–Ω—ã–π –±–æ—Ä–¥–µ—Ä
          } else {
            // –ú–µ–Ω–µ–µ 100% —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤ –∏–ª–∏ —É–¥–∞–ª—ë–Ω –∫–∞–∫ —Å—Ä—ã–≤ = –°—Ä—ã–≤
            status = 'failed';
            statusText = '–°—Ä—ã–≤';
            statusClass = 'failed';
            borderClass = 'completed-failure'; // –ö—Ä–∞—Å–Ω—ã–π –±–æ—Ä–¥–µ—Ä
            
            if (challenge.deletedAsFailure) {
              statusText = '–°—Ä—ã–≤ (—É–¥–∞–ª—ë–Ω)';
            }
          }
        }
        
        const startDate = new Date(challenge.startDate);
        const formattedDate = startDate.toLocaleDateString('ru-RU', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });
        
        // –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        const completionDate = getCompletionDate(challenge);
        const completionFormatted = completionDate.toLocaleDateString('ru-RU', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });
        
        // –ù–∞—Ö–æ–¥–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤ –º–∞—Å—Å–∏–≤–µ allChallenges
        const originalIndex = allChallenges.findIndex(c => c.id === challenge.id);
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è –¢–û–õ–¨–ö–û –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
        const showDeleteButton = challenge.isActive;
        
        html += `
          <div class="challenge-item ${borderClass}">
            <div class="challenge-content" onclick="selectChallenge(${originalIndex})">
              <div class="challenge-title">
                <span class="status-badge ${statusClass}">${statusText}</span>
                ${challenge.exercise}
              </div>
              <div class="challenge-info">
                –°—Ç–∞–≤–∫–∞: ${challenge.bet} ‚ÇΩ ‚Ä¢ ${formattedDate}
                ${!challenge.isActive ? `‚Ä¢ ${completionFormatted}` : ''}
              </div>
              ${timeWarning}
              <div class="challenge-stats">
                ${challenge.isActive ? 
                  `üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: ${progressPercent}% ‚Ä¢ –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${challenge.daysSkipped}/${challenge.maxSkips}` :
                  status === 'completed' ? 
                    `‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Ä¢ –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${challenge.daysSkipped}/${challenge.maxSkips}` :
                    `üíÄ ${challenge.deletedAsFailure ? '–£–¥–∞–ª—ë–Ω –∫–∞–∫ —Å—Ä—ã–≤' : '–°—Ä—ã–≤'} ‚Ä¢ –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${challenge.daysSkipped}/${challenge.maxSkips}`
                }
              </div>
            </div>
            ${showDeleteButton ? `<button class="delete-btn" onclick="showDeleteModal(${originalIndex})" type="button">üóë</button>` : ''}
          </div>
        `;
      });
      
      challengesList.innerHTML = html;
      
      // –°–æ–∑–¥–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
      createPagination();
    }
    
    // –í—ã–±–æ—Ä —á–µ–ª–ª–µ–Ω–¥–∂–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
    window.selectChallenge = function(index) {
      if (index >= 0 && index < allChallenges.length) {
        currentHabitIndex = index;
        const challenge = allChallenges[index];
        
        if (challenge.isActive) {
          renderActiveHabit();
          showScreen('active');
        } else {
          // –î–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          showResultForCompleted(index);
        }
      }
    };
    
    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ—Ç–∫–∏ –¥–Ω—è
    function markDay(status) {
      if (currentHabitIndex === -1 || !allChallenges[currentHabitIndex]) return;
      
      const currentHabit = allChallenges[currentHabitIndex];
      const today = new Date().toISOString().split('T')[0];
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ç–º–µ—á–∞–ª–∏ –ª–∏ —Å–µ–≥–æ–¥–Ω—è
      if (currentHabit.history.some(entry => entry.date === today)) {
        alert('–í—ã —É–∂–µ –æ—Ç–º–µ—Ç–∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å!');
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–æ–≤
      if (status === 'skipped') {
        if (currentHabit.daysSkipped >= currentHabit.maxSkips) {
          // –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤ - —Å—Ä—ã–≤ —á–µ–ª–ª–µ–Ω–¥–∂–∞
          if (confirm(`–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ (${currentHabit.maxSkips})! –ü—Ä–æ–ø—É—Å–∫ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ —Å—Ä—ã–≤—É —á–µ–ª–ª–µ–Ω–¥–∂–∞. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?`)) {
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é –∫–∞–∫ –ø—Ä–æ–ø—É—Å–∫
            currentHabit.history.unshift({
              date: today,
              status: 'skipped',
              timestamp: new Date().toISOString()
            });
            currentHabit.daysSkipped++;
            currentHabit.totalSkipped++;
            currentHabit.lastMarked = today;
            
            // –ß–µ–ª–ª–µ–Ω–¥–∂ –ø—Ä–æ–≤–∞–ª–µ–Ω –∏–∑-–∑–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤
            showResult(false);
            currentHabit.isActive = false;
            currentHabit.deletedAsFailure = false; // –≠—Ç–æ –Ω–µ —É–¥–∞–ª–µ–Ω–∏–µ, –∞ –æ–±—ã—á–Ω—ã–π —Å—Ä—ã–≤
            saveUserChallenges();
            renderActiveHabit();
            renderHistory();
          }
          return;
        }
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é
      currentHabit.history.unshift({
        date: today,
        status: status,
        timestamp: new Date().toISOString()
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
      if (status === 'completed') {
        currentHabit.daysDone++;
        currentHabit.totalCompleted++;
      } else if (status === 'skipped') {
        currentHabit.daysSkipped++;
        currentHabit.totalSkipped++;
      }
      
      currentHabit.lastMarked = today;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∞
      const totalMarked = currentHabit.daysDone + currentHabit.daysSkipped;
      
      if (totalMarked >= currentHabit.totalDays) {
        // –î–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –±–æ–ª—å—à–µ –¥–Ω–µ–π, —á–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
        // –ò –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å –ª–∏–º–∏—Ç
        if (currentHabit.daysDone > currentHabit.daysSkipped && currentHabit.daysSkipped <= currentHabit.maxSkips) {
          showResult(true);
        } else {
          showResult(false);
        }
        currentHabit.isActive = false;
      }
      
      saveUserChallenges();
      renderActiveHabit();
      renderHistory();
    }
    
    // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function showResult(success) {
      if (currentHabitIndex === -1 || !allChallenges[currentHabitIndex]) return;
      
      const currentHabit = allChallenges[currentHabitIndex];
      const title = success ? 'üéâ –£—Å–ø–µ—Ö!' : 'üíÄ –°—Ä—ã–≤';
      let text = success
        ? `–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —á–µ–ª–ª–µ–Ω–¥–∂: ¬´${currentHabit.title}¬ª!`
        : `–ß–µ–ª–ª–µ–Ω–¥–∂ –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω. ${currentHabit.bet} ‚ÇΩ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ) `;
      
      if (!success) {
        text += currentHabit.mode === 'charity'
          ? '–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. ‚ù§Ô∏è'
          : '—É—à–ª–∏ –≤ –æ–±—â–∏–π –∫–æ—Ç—ë–ª. üé≤';
          
        // –ï—Å–ª–∏ —Å—Ä—ã–≤ –∏–∑-–∑–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤
        if (currentHabit.daysSkipped > currentHabit.maxSkips) {
          text += `\n\n–ü—Ä–∏—á–∏–Ω–∞ —Å—Ä—ã–≤–∞: –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–¥–æ–ø—É—Å—Ç–∏–º–æ: ${currentHabit.maxSkips}, –ø—Ä–æ–ø—É—â–µ–Ω–æ: ${currentHabit.daysSkipped}).`;
        }
      }
      
      document.getElementById('result-title').textContent = title;
      document.getElementById('result-text').textContent = text;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      const stats = document.getElementById('result-stats');
      const totalDays = currentHabit.totalCompleted + currentHabit.totalSkipped;
      const successRate = totalDays > 0 ? (currentHabit.totalCompleted / totalDays * 100) : 0;
      
      stats.innerHTML = `
        <p>üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</p>
        <p>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${currentHabit.totalCompleted} –¥–Ω–µ–π</p>
        <p>‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${currentHabit.totalSkipped} –¥–Ω–µ–π (–ª–∏–º–∏—Ç: ${currentHabit.maxSkips})</p>
        <p>üèÜ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: ${Math.round(successRate)}%</p>
        ${!success && currentHabit.daysSkipped > currentHabit.maxSkips ? 
          `<p>‚ö†Ô∏è –ü—Ä–∏—á–∏–Ω–∞ —Å—Ä—ã–≤–∞: –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤</p>` : ''}
        ${currentHabit.deletedAsFailure ? `<p>üóëÔ∏è –ß–µ–ª–ª–µ–Ω–¥–∂ —É–¥–∞–ª—ë–Ω –∫–∞–∫ —Å—Ä—ã–≤ (–ø—Ä–æ—à–ª–æ –±–æ–ª–µ–µ 12 —á–∞—Å–æ–≤)</p>` : ''}
      `;
      
      showScreen('result');
    }
    
    // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–∞
    function showResultForCompleted(index) {
      const challenge = allChallenges[index];
      const totalDays = challenge.totalCompleted + challenge.totalSkipped;
      const successRate = totalDays > 0 ? 
        Math.round((challenge.totalCompleted / totalDays) * 100) : 0;
      
      // –£—Å–ø–µ—Ö —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ 100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ò –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ò –Ω–µ —É–¥–∞–ª—ë–Ω –∫–∞–∫ —Å—Ä—ã–≤
      const success = successRate === 100 && challenge.daysSkipped <= challenge.maxSkips && !challenge.deletedAsFailure;
      
      const title = success ? 'üéâ –í—ã–ø–æ–ª–Ω–µ–Ω–æ!' : 'üíÄ –°—Ä—ã–≤';
      let text = `–ß–µ–ª–ª–µ–Ω–¥–∂: ¬´${challenge.title}¬ª`;
      
      if (!success) {
        text += ` ‚Ä¢ ${challenge.bet} ‚ÇΩ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ) `;
        text += challenge.mode === 'charity'
          ? '–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. ‚ù§Ô∏è'
          : '—É—à–ª–∏ –≤ –æ–±—â–∏–π –∫–æ—Ç—ë–ª. üé≤';
          
        // –ï—Å–ª–∏ —Å—Ä—ã–≤ –∏–∑-–∑–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤
        if (challenge.daysSkipped > challenge.maxSkips) {
          text += `\n\n–ü—Ä–∏—á–∏–Ω–∞ —Å—Ä—ã–≤–∞: –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–ø—É—Å–∫–æ–≤ (–¥–æ–ø—É—Å—Ç–∏–º–æ: ${challenge.maxSkips}, –ø—Ä–æ–ø—É—â–µ–Ω–æ: ${challenge.daysSkipped}).`;
        }
        
        // –ï—Å–ª–∏ —Å—Ä—ã–≤ –∏–∑-–∑–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ 12 —á–∞—Å–æ–≤
        if (challenge.deletedAsFailure) {
          text += `\n\n–ü—Ä–∏—á–∏–Ω–∞ —Å—Ä—ã–≤–∞: —á–µ–ª–ª–µ–Ω–¥–∂ —É–¥–∞–ª—ë–Ω —á–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è.`;
        }
      }
      
      document.getElementById('result-title').textContent = title;
      document.getElementById('result-text').textContent = text;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
      const stats = document.getElementById('result-stats');
      
      stats.innerHTML = `
        <p>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–µ–ª–ª–µ–Ω–¥–∂–∞:</p>
        <p>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${challenge.totalCompleted} –¥–Ω–µ–π</p>
        <p>‚ùå –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${challenge.totalSkipped} –¥–Ω–µ–π (–ª–∏–º–∏—Ç: ${challenge.maxSkips})</p>
        <p>${success ? 'üèÜ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 100%' : 'üíÄ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: ' + successRate + '%'}</p>
        <p>üìÖ –ù–∞—á–∞–ª–æ: ${new Date(challenge.startDate).toLocaleDateString('ru-RU')}</p>
        ${success ? 
          '<p>üéâ –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í—Å–µ –¥–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ —Ä–∞–º–∫–∞—Ö –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤!</p>' : 
          `<p>üòî –ß–µ–ª–ª–µ–Ω–¥–∂ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω ${challenge.daysSkipped > challenge.maxSkips ? '–∏–∑-–∑–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤' : 
            challenge.deletedAsFailure ? '–∏–∑-–∑–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ 12 —á–∞—Å–æ–≤' : '–ø–æ–ª–Ω–æ—Å—Ç—å—é'}</p>`
        }
      `;
      
      showScreen('result');
    }
    
    // –£—Ç–∏–ª–∏—Ç—ã
    function showScreen(name) {
      Object.values(screens).forEach(s => {
        if (s !== screens.auth && s !== screens.main) {
          s.classList.add('hidden');
        }
      });
      screens[name].classList.remove('hidden');
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function saveUserChallenges() {
      const userData = getCurrentUserData();
      if (userData) {
        userData.challenges = allChallenges;
        userData.avatar = userAvatar;
        saveCurrentUserData(userData);
      }
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function loadUserData() {
      const userData = getCurrentUserData();
      if (userData) {
        allChallenges = userData.challenges || [];
        userAvatar = userData.avatar || null;
      } else {
        allChallenges = [];
        userAvatar = null;
      }
    }
    
    // ==================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ====================
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    function initEventHandlers() {
      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.dataset.tab;
          
          // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
          document.querySelectorAll('.auth-tab').forEach(t => {
            t.classList.remove('active');
          });
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ
          tab.classList.add('active');
          
          // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–æ—Ä–º—ã
          document.querySelectorAll('.auth-form').forEach(form => {
            form.classList.remove('active');
          });
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ñ–æ—Ä–º—É
          document.getElementById(`${tabName}-form`).classList.add('active');
          
          // –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
          document.getElementById('login-error').classList.remove('show');
          document.getElementById('register-error').classList.remove('show');
          document.getElementById('register-success').classList.remove('show');
        });
      });
      
      // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      document.getElementById('switch-to-register').addEventListener('click', (e) => {
        e.preventDefault();
        document.querySelector('.auth-tab[data-tab="register"]').click();
      });
      
      // –ü–µ—Ä–µ—Ö–æ–¥ –∫–æ –≤—Ö–æ–¥—É
      document.getElementById('switch-to-login').addEventListener('click', (e) => {
        e.preventDefault();
        document.querySelector('.auth-tab[data-tab="login"]').click();
      });
      
      // –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞
      document.getElementById('btn-login').addEventListener('click', () => {
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value.trim();
        const errorElement = document.getElementById('login-error');
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!email || !password) {
          errorElement.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
          errorElement.classList.add('show');
          return;
        }
        
        // –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞
        const result = loginUser(email, password);
        
        if (result.success) {
          // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
          loadUserData();
          screens.auth.classList.add('hidden');
          screens.main.classList.remove('hidden');
          initializeApp();
        } else {
          // –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞
          errorElement.textContent = result.message;
          errorElement.classList.add('show');
        }
      });
      
      // –ö–Ω–æ–ø–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
      document.getElementById('btn-register').addEventListener('click', () => {
        const username = document.getElementById('register-username').value.trim();
        const email = document.getElementById('register-email').value.trim();
        const password = document.getElementById('register-password').value.trim();
        const confirmPassword = document.getElementById('register-confirm-password').value.trim();
        const errorElement = document.getElementById('register-error');
        const successElement = document.getElementById('register-success');
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!username || !email || !password || !confirmPassword) {
          errorElement.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
          errorElement.classList.add('show');
          return;
        }
        
        if (password !== confirmPassword) {
          errorElement.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
          errorElement.classList.add('show');
          return;
        }
        
        // –ü–æ–ø—ã—Ç–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        const result = registerUser(username, email, password);
        
        if (result.success) {
          // –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
          successElement.textContent = result.message;
          successElement.classList.add('show');
          errorElement.classList.remove('show');
          
          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
          setTimeout(() => {
            const loginResult = loginUser(email, password);
            if (loginResult.success) {
              loadUserData();
              screens.auth.classList.add('hidden');
              screens.main.classList.remove('hidden');
              initializeApp();
            }
          }, 1000);
        } else {
          // –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
          errorElement.textContent = result.message;
          errorElement.classList.add('show');
          successElement.classList.remove('show');
        }
      });
      
      // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ
      document.getElementById('btn-profile-logout').addEventListener('click', () => {
        logoutUser();
        screens.auth.classList.remove('hidden');
        screens.main.classList.add('hidden');
        
        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º
        document.getElementById('login-email').value = '';
        document.getElementById('login-password').value = '';
        document.getElementById('register-username').value = '';
        document.getElementById('register-email').value = '';
        document.getElementById('register-password').value = '';
        document.getElementById('register-confirm-password').value = '';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞
        document.querySelector('.auth-tab[data-tab="login"]').click();
      });
      
      // –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      document.getElementById('btn-new').onclick = () => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º —ç–∫—Ä–∞–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è
        const activeChallenges = allChallenges.filter(c => c.isActive);
        if (activeChallenges.length >= MAX_CHALLENGES) {
          document.getElementById('challenge-limit-warning').style.display = 'block';
        } else {
          document.getElementById('challenge-limit-warning').style.display = 'none';
        }
        showScreen('create');
      };
      
      document.getElementById('btn-view-challenges').onclick = () => {
        renderChallengesList();
        showScreen('challenges');
      };
      
      document.getElementById('btn-view-all-challenges').onclick = () => {
        renderChallengesList();
        showScreen('challenges');
      };
      
      document.getElementById('btn-to-challenges').onclick = () => {
        renderChallengesList();
        showScreen('challenges');
      };
      
      document.getElementById('btn-add-new-challenge').onclick = () => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º —ç–∫—Ä–∞–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è
        const activeChallenges = allChallenges.filter(c => c.isActive);
        if (activeChallenges.length >= MAX_CHALLENGES) {
          document.getElementById('challenge-limit-warning').style.display = 'block';
        } else {
          document.getElementById('challenge-limit-warning').style.display = 'none';
        }
        showScreen('create');
      };
      
      document.getElementById('btn-back-from-challenges').onclick = () => {
        showScreen('start');
      };
      
      document.getElementById('btn-create-cancel').onclick = () => showScreen('start');
      document.getElementById('btn-new-again').onclick = () => {
        currentHabitIndex = -1;
        showScreen('start');
      };
      
      // –ö–Ω–æ–ø–∫–∞ —Å–ø—Ä–∞–≤–∫–∏
      document.getElementById('btn-help').onclick = () => {
        helpModal.classList.remove('hidden');
      };
      
      // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–ø—Ä–∞–≤–∫–∏
      document.getElementById('btn-close-help').onclick = () => {
        helpModal.classList.add('hidden');
      };
      
      // –ö–Ω–æ–ø–∫–∞ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
      document.getElementById('btn-profile').onclick = () => {
        renderProfile();
        showScreen('profile');
      };
      
      // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ –∏–∑ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
      document.getElementById('btn-back-from-profile').onclick = () => {
        showScreen('start');
      };
      
      // –ö–Ω–æ–ø–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
      document.getElementById('btn-avatar').onclick = () => {
        document.getElementById('avatar-input').click();
      };
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –∞–≤–∞—Ç–∞—Ä–∞
      document.getElementById('avatar-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            userAvatar = e.target.result;
            saveUserChallenges();
            updateAvatarDisplay();
          };
          reader.readAsDataURL(file);
        }
      });
      
      // –ö–Ω–æ–ø–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
      document.getElementById('btn-confirm-delete').onclick = () => {
        deleteChallenge(challengeToDeleteIndex);
        hideDeleteModal();
        renderChallengesList();
      };
      
      document.getElementById('btn-cancel-delete').onclick = () => {
        hideDeleteModal();
      };
      
      // –ö–Ω–æ–ø–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞
      document.getElementById('btn-save-login').onclick = () => {
        handleLoginChange();
      };
      
      document.getElementById('btn-cancel-login').onclick = () => {
        hideChangeLoginModal();
      };
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
      document.getElementById('days-input').addEventListener('input', updateSkipLimitInfo);
      
      // –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
      document.getElementById('btn-mark-done').onclick = () => {
        markDay('completed');
      };
      
      // –û—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–æ–ø—É—Å–∫
      document.getElementById('btn-mark-skipped').onclick = () => {
        markDay('skipped');
      };
      
      // –°–¥–∞—Ç—å—Å—è
      document.getElementById('btn-give-up').onclick = () => {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –ø–æ–ª–Ω—ã–π —Å—Ä—ã–≤. –°—Ç–∞–≤–∫–∞ –±—É–¥–µ—Ç "–ø–æ—Ç–µ—Ä—è–Ω–∞".')) {
          const currentHabit = allChallenges[currentHabitIndex];
          currentHabit.history.unshift({
            date: new Date().toISOString().split('T')[0],
            status: 'gave-up',
            timestamp: new Date().toISOString()
          });
          showResult(false);
          currentHabit.isActive = false;
          currentHabit.deletedAsFailure = false; // –≠—Ç–æ –Ω–µ —É–¥–∞–ª–µ–Ω–∏–µ, –∞ —Å–¥–∞—á–∞
          saveUserChallenges();
        }
      };
      
      // –°–æ–∑–¥–∞–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∞
      document.getElementById('btn-create-confirm').onclick = () => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π
        const activeChallenges = allChallenges.filter(c => c.isActive);
        if (activeChallenges.length >= MAX_CHALLENGES) {
          alert(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤ ${MAX_CHALLENGES} –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π. –ó–∞–≤–µ—Ä—à–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —Ç–µ–∫—É—â–∏—Ö, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π.`);
          return;
        }
        
        const exercise = document.getElementById('exercise-select').value;
        const reps = parseInt(document.getElementById('reps-input').value) || 0;
        const sets = parseInt(document.getElementById('sets-input').value) || 0;
        const daysPerWeek = parseInt(document.getElementById('days-input').value) || 3;
        const bet = parseInt(document.getElementById('bet-input').value) || 0;
        const mode = document.getElementById('mode-select').value;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
        if (reps > 30) {
          alert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –≤ –ø–æ–¥—Ö–æ–¥–µ: 30');
          return;
        }
        
        if (sets > 15) {
          alert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥–æ–≤ –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É: 15');
          return;
        }
        
        // –ò–ó–ú–ï–ù–ï–ù–û: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (3-6 –≤–º–µ—Å—Ç–æ 1-6)
        if (daysPerWeek < 3 || daysPerWeek > 6) {
          alert('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 3 –¥–æ 6');
          return;
        }
        
        if (bet > 1500) {
          alert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 1500 ‚ÇΩ');
          return;
        }
        
        if (!exercise || reps <= 0 || sets <= 0 || daysPerWeek <= 0) {
          alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
          return;
        }
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–Ω—è—Ç–Ω—É—é —Ü–µ–ª—å
        let habitText = `${exercise}: ${sets} –ø–æ–¥—Ö–æ–¥(–æ–≤) –ø–æ ${reps} —Ä–∞–∑`;
        if (['–ë–µ–≥', '–•–æ–¥—å–±–∞', '–ü–ª–∞–Ω–∫–∞'].includes(exercise)) {
          // –î–ª—è –≤—Ä–µ–º–µ–Ω–∏/–¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –ø–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º –∫–∞–∫ –µ—Å—Ç—å
        }
        habitText += `, ${daysPerWeek} —Ä–∞–∑(–∞) –≤ –Ω–µ–¥–µ–ª—é`;
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤
        const maxSkips = calculateMaxSkips(daysPerWeek);
        
        const newChallenge = {
          id: Date.now(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
          title: habitText,
          exercise,
          reps,
          sets,
          daysPerWeek,
          maxSkips, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤
          bet,
          mode,
          startDate: new Date().toISOString().split('T')[0],
          daysDone: 0,
          daysSkipped: 0,
          totalDays: 7, // –Ω–µ–¥–µ–ª—å–Ω—ã–π —Ü–∏–∫–ª
          isActive: true,
          lastMarked: null,
          history: [],
          totalCompleted: 0,
          totalSkipped: 0,
          createdAt: new Date().toISOString(),
          deletedAsFailure: false // –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π —á—Ç–æ —á–µ–ª–ª–µ–Ω–¥–∂ –±—ã–ª —É–¥–∞–ª—ë–Ω –∫–∞–∫ —Å—Ä—ã–≤
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —á–µ–ª–ª–µ–Ω–¥–∂ –≤ –º–∞—Å—Å–∏–≤
        allChallenges.push(newChallenge);
        currentHabitIndex = allChallenges.length - 1;
        
        saveUserChallenges();
        renderActiveHabit();
        showScreen('active');
      };
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
    function initializeApp() {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏–º–∏—Ç–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤
      updateSkipLimitInfo();
      
      initFilters();
      
      // –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫, –∏–Ω–∞—á–µ –Ω–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
      const activeChallenges = allChallenges.filter(c => c.isActive);
      if (activeChallenges.length > 0) {
        renderChallengesList();
        showScreen('challenges');
        
        // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —á–µ–ª–ª–µ–Ω–¥–∂ (–ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è)
        const lastActiveIndex = allChallenges.findIndex(c => 
          c.id === activeChallenges[activeChallenges.length - 1].id
        );
        currentHabitIndex = lastActiveIndex;
      } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
        showScreen('start');
      }
    }
    
    // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function init() {
      initEventHandlers();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–æ—à–µ–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
      const currentUser = getCurrentUser();
      if (currentUser) {
        loadUserData();
        screens.auth.classList.add('hidden');
        screens.main.classList.remove('hidden');
        initializeApp();
      } else {
        screens.auth.classList.remove('hidden');
        screens.main.classList.add('hidden');
      }
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>